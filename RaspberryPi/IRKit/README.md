# IRKit

>IRKitは、WiFi機能の付いたオープンソースな赤外線リモコンデバイス。
>家庭のエアコンやテレビ、ライトなど、赤外線で操作できる家電を、
>WiFiをとおして、iPhoneやiPad,Androidスマートフォンなどから操作できるようにするものです。
>http://getirkit.com/

IRKitを初期設定し、PCからリモコン操作を可能にしつつ、
最終的にSiriから対象デバイスを操作できるようにする。


### 1.IRKit の初期設定
IRKitを電源に接続。IRKitの公式アプリにそって初期設定をする。
その際、IRKitとRaspberry Piが同じネットワークに接続されるように設定する。

### 2.IRKitのIPアドレスを調査
IRKitを使ってリモコン操作するためには、
IRKitのIPアドレスを知る必要があります。

初期設定の際に、表示されたIRKitの名称IRKitXXXXXXを使って、
下記のようにターミナルからコマンドを打つ

```
ping IRKitXXXXXX.local
```

実行後に表示される値の中にIPアドレスがあるのでそちらメモする。
仮に 000.000.0.00 として以降を解説する。

### 3.IRKitでリモコンの赤外線情報を取得する

Raspberry Piにログインする。

```
ssh xx@xxx.pi
```

IRKitに向けて、リモコンを向けて操作したいボタンを押す。

押した後、ターミナルで下記コマンドを実行。
```
curl -i "http://000.000.0.00/messages" -H "X-Requested-With: curl"
```

返却される値が赤外線情報なのでメモっておく。
```
{"format":"raw","freq":38,"data":[6881,3458,873,873,873,873,873,2537,873,2537,873,873,873,2537,873,873,873,873,873,873,873,2537,873,873,873,873,873,2537,873,873,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,873,873,873,873,873,873,873,873,873,873,2537,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,873,873,65535,0,65535,0,16832,6881,3341,873,873,873,873,873,2537,873,2537,873,873,873,2537,873,873,873,873,873,873,873,2537,873,873,873,873,873,2537,873,873,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,873,873,873,873,873,873,873,873,873,873,2537,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,873,873,65535,0,65535,0,16832,6881,3458,873,873,873,873,873,2537,873,2537,873,873,873,2537,873,873,873,873,873,873,873,2537,873,873,873,873,873,2537,873,873,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,873,873,873,873,873,873,873,873,873,873,2537,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,873,873]}
```

次に、Raspberry Pi から IRKitへのこの赤外線情報を送る。
```
curl -i "http://000.000.0.00/messages" -H "X-Requested-With: curl" -d '{"format":"raw","freq":38,"data":[6881,3458,873,873,873,873,873,2537,873,2537,873,873,873,2537,873,873,873,873,873,873,873,2537,873,873,873,873,873,2537,873,873,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,873,873,873,873,873,873,873,873,873,873,2537,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,873,873,65535,0,65535,0,16832,6881,3341,873,873,873,873,873,2537,873,2537,873,873,873,2537,873,873,873,873,873,873,873,2537,873,873,873,873,873,2537,873,873,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,873,873,873,873,873,873,873,873,873,873,2537,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,873,873,65535,0,65535,0,16832,6881,3458,873,873,873,873,873,2537,873,2537,873,873,873,2537,873,873,873,873,873,873,873,2537,873,873,873,873,873,2537,873,873,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,873,873,873,873,873,873,873,873,873,873,2537,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,2537,873,873,873,873,873,2537,873,873,873,873,873]}'
```

コマンドを打った後、IRKitのLEDが点滅しつつ、
リモコン操作の対象デバイスが動いたら接続テスト成功。


### 4.HomebridgeにIRKit用の設定をする

HomebridgeにIRKit用のプラグインを追加する
```
sudo npm install -g homebridge-irkit
sudo npm install -g homebridge-cmd
```

Homebridgeの設定ファイルにIRKit用の設定を追加

```
{
  "bridge": {
    "name": "Homebridge",
    "username": "xx:xx:xx:xx:xx:xx",
    "port": 12345,
    "pin": "012-34-567"
  },
  "platforms": [
    {
      "platform": "PhilipsHue",
      "name": "Philips Hue",
      "ip_address": "000.000.0.00",
      "username": "xxxxxx",
      "excludephilips": false
    }
  ],
  "accessories": [
    {
      "accessory": "IRKit",
      "name": "家電の名前",
      "irkit_url": "http://000.000.0.00/messages",
      "on_form": ここにON用の赤外線情報,
      "off_form": ここにOFF用の赤外線情報
    }
  ]
}
```

入力する際、[https://syncer.jp/json-prettyprint](ここで)JSON構文が正しいかチェックすること。
構文が正しくない場合エラーになります。


### 5. Homebridgeの再起動

まずは Raspberry Pi を再起動
```
sudo reboot
```

Raspberry Piに再度sshでログイン、下記コマンドを実行。
```
homebridge
```
